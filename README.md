# NeuroBot

### Описание

**NeuroBot** - это бот, который взаимодействует с API нейросети (Giga Chat) для генерации ответов на запросы пользователей.

**Возможности бота:**
* Бот выводит приветсвенное сообщение по команде /start.
* Бот выводит сообщение с инструкцией по команде /help.
* Бот принимает текстовые сообщения от пользователей.
* Для каждого текстового сообщения от пользователя бот запрашивает ответ у API Giga Chat:
- В случае успеха бот отправляет пользователю ответ нейросети;
- При возникновении ошибки бот отправляет пользователю сообщение об ошибке;
* Бот сохраняет историю взаимодействия пользователя с нейросетью в PostgreSQL.

**Ограничения бота:**
1. Сохраняет сообщения пользователя и ответы GPT, но не отправляет эти сообщения в качестве контекста для нейросети;
2. Не более 10 запросов в секунду: 
- Для обращения к API нейросети требуется получить access token (API не позволяет получить более 10 токенов в секунду или сформировать Refresh Token);
- Т.к. токен на данный момент не сохраняется в кэш, ограничение на количество запросов распространяется на бота.
3. Некоторые ответы GigaChat могут быть урезанными:
- Для подготовки ответа GigaChat (на бесплатном тарифе) использует не более 500 токенов (Некоторые ответы могут резко обрываться.).


### Стек

* Python (3.12.7)
* Aiogram
* Pydantic
* HTTPX
* SQLAlchemy
* PostgreSQL
* Docker

### Схема БД

1. TABLE tg_users
* id  (SERIAL NOT NULL, PRIMARY KEY (id), UNIQUE)
* username (VARCHAR)


2. TABLE messages
* id (SERIAL NOT NULL, PRIMARY KEY, UNIQUE)
* text_request (VARCHAR NOT NULL)
* text_response (VARCHAR NOT NULL)
* user_id (FOREIGN KEY(user_id) REFERENCES tg_users (id))


### Как развернуть проект

**Клонировать репозиторий:**
```
git clone git@github.com:NikitaPreis/neuro_bot.git
cd neuro_bot
```

**Установить переменные окружения:**

*Все необходимые переменные окружения расположены в файле CHANGEME.*

*Переменные окружения:*
* Переименовать файл CHANGEME в ".env";
* Установить нужные значения для переменных.

```
# Токен тг-бота
BOT_API_TOKEN=<YOUR_BOT_API_TOKEN>

# Переменные окружения для Giga Chat
GIGA_CHAT_CLIENT_ID=<YOUR_GIGA_CHAT_CLIENT_ID>
GIGA_CHAT_AUTH_KEY=<YOUR_GIGA_CHAT_AUTH_KEY>

# Переменные окружения для работы с БД (Docker Compose, PostgreSQL)
POSTGRES_PASSWORD=mysecretpassword
POSTGRES_USER=postgres
POSTGRES_DB=neuro_bot
POSTGRES_HOST=db
POSTGRES_PORT=5432

# Переменные окружения для работы с БД (ORM: SQLAlchemy):
DB_DRIVER=postgresql+asyncpg
DB_PASSWORD=mysecretpassword
DB_USER=postgres
DB_NAME=neuro_bot
DB_HOST=db
DB_PORT=5432

```

**Запустить Docker и запустить бота с помощью Docker Compose:**
```
# neuro_bot/

docker compose up --build
```

### Ссылка на бота:

После запуска бот будет доступен по ссылке:
* https://t.me/check_neuro_bot

### Примеры ответов бота:

**Command start**

```
user:
    - /start 
bot:
    -  Добрый день! Этот бот позволяем вам взаимодействовать с нейросетями для поиска информации, генерации текстов или других целей. На данный момент единственная доступная модель -- Giga Chat.

    Отправьте любое сообщение в чат, чтобы бот обратился к Giga Chat и подготовил ответ.
```

**Command help**
```
user:
    - /help
bot:
    - Этот бот позволяем вам взаимодействовать с нейросетями для генерации идей и текстов, поиска информации или ведения беседы. На данный момент единственная доступная модель -- Giga Chat.
    
    Отправьте любое сообщение в чат, чтобы бот обратился к Giga Chat и подготовил ответ.
```

**GPT response**
```
user:
    - Что такое нейросеть?
bot:
    Нейросеть – это математическая модель и алгоритм, вдохновленный биологическими нейронными сетями, такими как мозг человека. Основная идея нейросети заключается в том, чтобы обучить её распознавать закономерности в данных и делать предсказания на основе этих закономерностей.

    Основные компоненты нейросети:
    1. Нейроны (или узлы): элементарные единицы сети, которые обрабатывают входные данные...
```
